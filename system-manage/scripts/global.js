define(["template","mobilebone"],function(a,b){window.template=a,window.Mobilebone=b,mui.init({gestureConfig:{tap:!1,doubletap:!1,longtap:!1,hold:!1,flick:!1,swipe:!1,drag:!1,pinch:!1,hold:!1,release:!1}}),$.fn.serializeJSON=function(){{var a={},b=this.serializeArray();this.serialize()}return $(b).each(function(){a[this.name]?$.isArray(a[this.name])?a[this.name].push(this.value):a[this.name]=[a[this.name],this.value]:a[this.name]=this.value}),a};var c={};c.userCallback=function(b,d,e){var f=$(e.target),g=!("false"===f.attr("data-is-multiple")),h=$(".page.selector-user .mui-bar-nav"),i=$(".page.selector-user .mui-indexed-list").attr("data-is-multiple",g),j=i.attr("data-bind-event");i.height($(window).height()-h.height()),c.target=f,c.isMultiple=g,g?$(b).find(".mui-btn-confirm").removeClass("hide"):$(b).find(".mui-btn-confirm").addClass("hide"),j||(i.attr("data-bind-event",!0),$(".page.selector-user .mui-indexed-list").on("tap",".mui-checkbox",function(){var a=$(this).find("input").prop("checked",!0),b=!("false"===a.closest(".mui-indexed-list").attr("data-is-multiple"));b||"function"==typeof window.selectorUserCallback&&window.selectorUserCallback(window.selector)}),$(".page.selector-user").on("tap",".mui-btn-confirm",function(){"function"==typeof window.selectorUserCallback&&window.selectorUserCallback(window.selector)}),popup.showToast({message:"正在加载中...",type:"loading"}),$.when($.ajax({url:api.getSelectorUsers,dataType:"json",timeout:ajaxTimeout})).done(function(b){return popup.hideToast(),b.status?(i.find(".mui-indexed-list-inner .mui-table-view").html(a("users-tmpl",{data:b.data})),i.find(".mui-indexed-list-bar .list").html(a("users-indexed-tmpl",{data:b.data})),window.indexedList=new mui.IndexedList(i[0]),void(i.find(".mui-indexed-list-bar .list a").height()>20&&i.find(".mui-indexed-list-bar .list").addClass("fix"))):void popup.showToast({message:"获取用户信息失败。",type:"error"})}).fail(function(){popup.showToast({message:"获取用户信息失败。",type:"error"})}))},c.userFallback=function(){var a=$(".page.selector-user .mui-indexed-list .mui-checkbox input:checked");a.prop("checked",!1)},c.roleCallback=function(b,d,e){var f=$(e.target),g=!("false"===f.attr("data-is-multiple")),h=$(".page.selector-role .mui-table-view").attr("data-is-multiple",g),i=h.attr("data-bind-event");h.height($(window).height()),c.target=f,c.isMultiple=g,g?$(b).find(".mui-btn-confirm").removeClass("hide"):$(b).find(".mui-btn-confirm").addClass("hide"),i||(h.attr("data-bind-event",!0),$(".page.selector-role .mui-table-view").on("tap",".mui-checkbox",function(){var a=$(this).find("input").prop("checked",function(a,b){return!b}),b=!("false"===a.closest(".mui-table-view").attr("data-is-multiple"));return b||"function"==typeof window.selectorRoleCallback&&window.selectorRoleCallback(window.selector),!1}),$(".page.selector-role").on("tap",".mui-btn-confirm",function(){"function"==typeof window.selectorRoleCallback&&window.selectorRoleCallback(window.selector)}),popup.showToast({message:"正在加载中...",type:"loading"}),$.when($.ajax({url:api.getRole,data:{pageSize:1e4,pageNumber:1},dataType:"json",timeout:ajaxTimeout})).done(function(b){return popup.hideToast(),b.status?void h.html(a("roles-tmpl",{data:b.data})):void popup.showToast({message:"获取角色信息失败。",type:"error"})}).fail(function(){popup.showToast({message:"获取角色信息失败。",type:"error"})}))},c.roleFallback=function(){var a=$(".page.selector-role .mui-table-view .mui-checkbox input:checked");a.prop("checked",!1)},c.deptCallback=function(b,d,e){var f=$(e.target),g=!("false"===f.attr("data-is-multiple")),h=$(".page.selector-dept .mui-table-view").attr("data-is-multiple",g),i=$(".page.selector-dept .title"),j=$(".page.selector-dept .selected"),k=h.attr("data-bind-event");c.target=f,c.isMultiple=g,g?$(b).find(".mui-btn-confirm").removeClass("hide"):$(b).find(".mui-btn-confirm").addClass("hide"),k||(h.attr("data-bind-event",!0),$(".page.selector-dept .mui-table-view").on("tap",".mui-checkbox",function(){var b=$(this).find("input").prop("checked",function(a,b){return!b}),c=b.closest("li"),d=c.attr("data-id"),e=c.attr("data-name");b.prop("checked")&&0===j.find('li[data-id="'+d+'"]').size()?(j.find("li.placeholder").remove(),j.append(a("depts-selected-tmpl",{data:{id:d,name:e}})),$(".selected-container").scrollLeft(1e4)):b.prop("checked")||j.find('li[data-id="'+d+'"]').remove(),0===j.find("li").size()&&j.append('<li class="placeholder">请选择部门...<a>');var f=!("false"===b.closest(".mui-table-view").attr("data-is-multiple"));f||"function"==typeof window.selectorRoleCallback&&window.selectorRoleCallback(window.selector)}),$(".page.selector-dept .selected").on("tap",".mui-delete",function(){var a=$(this).closest("li"),b=a.attr("data-id");a.closest("li").remove(),0===j.find("li").size()&&j.append('<li class="placeholder">请选择部门...<a>'),h.find('li[data-id="'+b+'"] input').prop("checked",!1)}),$(".page.selector-dept").on("tap",".mui-bar-nav .title a",function(){var a=$(this),b=a.closest("li"),d=a.closest(".title"),e=b.index(),f=a.attr("data-id");d.find("li").filter(function(a){return a>e}).remove(),c.loadingDept(f)}),$(".page.selector-dept .mui-table-view").on("tap",".mui-more",function(){var b=$(this).closest("li"),d=b.attr("data-id"),e=b.attr("data-name");if(!(i.find('a[data-id="'+d+'"]').size()>0)){{i.append(a("depts-hd-tmpl",{data:{id:d,name:e}}))}c.loadingDept(d)}}),$(".page.selector-dept").on("tap",".mui-btn-confirm",function(){"function"==typeof window.selectorDeptCallback&&window.selectorDeptCallback(window.selector)}),popup.showToast({message:"正在加载中...",type:"loading"}),$.when($.ajax({url:api.getDept,data:{id:0},dataType:"json",timeout:ajaxTimeout})).done(function(b){return popup.hideToast(),b.status?(h.html(a("depts-tmpl",{data:b.data})),void i.html(a("depts-hd-tmpl",{data:b.data}))):void popup.showToast({message:"获取部门信息失败。",type:"error"})}).fail(function(){popup.showToast({message:"获取部门信息失败。",type:"error"})}))},c.deptFallback=function(){$(".page.selector-dept .selected li").remove().append('<li class="placeholder">请选择部门...<a>')},c.loadingDept=function(b){popup.showToast({message:"正在加载部门信息...",type:"loading"}),$.when($.ajax({url:api.getDept,data:{id:b},dataType:"json",timeout:ajaxTimeout})).done(function(c){return popup.hideToast(),c.status?(_cdept=c.data,c.data.dept=[],0==b?c.data.dept=[{id:1,name:"产品部"},{id:2,name:"工程一部"},{id:3,name:"工程二部"},{id:4,name:"工程三部"},{id:5,name:"工程四部"}]:6>b?c.data.dept=[{id:6,name:"Web部"},{id:7,name:"Java部"},{id:8,name:"运维部"}]:9>b&&(c.data.dept=[{id:9,name:"测试部门1"},{id:10,name:"测试部门2"},{id:11,name:"测试部门3"}]),void $(".page.selector-dept .mui-table-view").html(a("depts-tmpl",{data:c.data}))):void popup.showToast({message:"加载部门信息失败。",type:"error"})}).fail(function(){popup.showToast({message:"加载部门信息失败。",type:"error"})})},window.selector=c,$("html.mobilebone").size()>0&&Mobilebone.init()});