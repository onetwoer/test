var ajaxTimeout=1e4;!function(){var a=window.CTX||"http://http://localhost:9000/",b="",c=function(){return+new Date};a=b;var d={getServerTime:a+"task/gold/getSystemTime?timestamp="+c(),getTask:a+"task/expireTaskList?timestamp="+c(),getCompletedTask:a+"task/completedTaskList?timestamp="+c(),taskFinish:a+"task/finish?timestamp="+c(),taskRestart:a+"task/restart?timestamp="+c(),taskAddGold:a+"task/gold/addGold?timestamp="+c(),taskRemoveGold:a+"task/gold/cancelGold?timestamp="+c()};window.api=d}(),function(){function a(){var a=$(".gold-grid li.activate .icon-gold"),c=$(".task-list li");d&&(a.draggable("destroy"),c.droppable("destroy")),b(),a.draggable({clone:!0,cloneClass:"clone"}).on("draggable:start",function(a,b){$(b.item).closest(".gold").find(".clone").html("1")}).on("draggable:stop",function(a,b){var c=$(b.item),d=c.closest("li");d.is("[data-index]")&&d.find(".clone").remove()}),c.droppable({hoverClass:"active"}).on("droppable:drop",function(a,b){var c=$(b.item),d=$(b.clone),e=$(a.target).closest("li");if(e.closest(".task-list.finished").size()>0)return!1;var f=!0,g=$(b.item).closest("li.activate");0===g.size()&&(f=!1,g=$(b.item).closest(".gold"));var h=e.find(".gold");return h[0]===g[0]?!1:void setTimeout(function(){if(h.find(".icon-gold").remove(),h.attr("data-count",function(a,b){return parseInt(b)+1}),c.html(h.attr("data-count")).appendTo(h),d.addClass("clone").appendTo(g),f)g.addClass("used");else{d.remove();var a=0;g.attr("data-count",function(b,c){return a=parseInt(c)-1}),a>0&&g.append('<i class="icon-gold">'+a+"</>")}},10)}),d=!0}function b(){var a=$(".task-list .gold .icon-gold[data-index]"),b=$(".gold-grid");e&&(a.draggable("destroy"),b.droppable("destroy")),a.draggable({}),b.droppable({}).on("droppable:drop",function(a,b){var c=$(b.item),d=$(b.clone).html(""),e=c.closest(".gold"),f=$(".gold-grid li.activate");if(c.closest("li[data-index]").size()>0)return!1;var g=c.attr("data-index"),h=f.attr("data-index");return g!==h?!1:void setTimeout(function(){f.removeClass("used").find(".clone").remove(),c.appendTo(f),d.remove();var a=0;e.attr("data-count",function(b,c){return a=parseInt(c)-1}),a>0&&e.append('<i class="icon-gold">'+a+"</>")},10)}),e=!0}function c(){var b=$(".gold-grid li").addClass("activate"),c=new Date,d=c.getHours(),e=c.getMinutes(),g=2*(d-7);e>=30&&g++,b.not(".used").filter(function(){return $(this).index()<g}).addClass("expire").removeClass("activate"),b.filter(function(){return $(this).index()>g}).addClass("nonactivated").removeClass("activate");var h=b.filter(".activate").last().index();h!=f&&(f=h,a())}!function(){$(".gold-grid li").each(function(a){$(this).attr("data-index",+a),$(this).find(".icon-gold").attr("data-index",+a)}),$(".task-list.unfinished").html(template("task-tmpl",{data:task})),$(".task-list.finished").html(template("task-tmpl",{data:taskCompleted,status:"Completed"}))}(),function(){$(document).on("tap",".task-list li .checkbox",function(){var a=$(this),b=a.closest("li");a.toggleClass("checked");var c=a.closest(".task-list").is(".finished"),d=$(c?".task-list.unfinished":".task-list.finished");b.animate({opacity:.1},200,function(){b.appendTo(d).css("opacity","1")})})}();var d=!1,e=!1,f=-1;c(),setInterval(c,1e4)}();